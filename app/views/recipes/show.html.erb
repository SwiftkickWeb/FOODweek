<% content_for :page_header do %>
  <h1>How's This One Look?</h1>
<% end %>

<section class="recipe">
  <h2 class="recipe__name"><%= @recipe.name %></h2>
  <% if @recipe.user.present? %>
    <h3 class="recipe__byline"><%= @recipe.user.email %></h3>
  <% end %>

  <p class="recipe__time"><%= @recipe.time %> minutes</p>
  <p class="recipe__ingredients"><%= markdown(@recipe.ingredients) %></p>
  <p class="recipe__steps"><%= markdown(@recipe.steps) %></p>
</section>

<% if user_signed_in? %>
  <section class="recipe-actions">
    <ul class="recipe-actions__list">
      <!-- If this recipe is in the current user's meal plan,
           allow them the chance to remove said recipe. -->
      <% if @meal_plan.recipes.include?(@recipe) %>
        <li class="recipe-actions__list-item">
          <%= render partial: "meal_plans/hidden_form_remove_recipe",
            locals: {
              meal_plan: @meal_plan,
              recipe: @recipe,
            }
          %>
        </li>

      <!-- Otherwise, allow the current user to add the recipe
           to their meal plan. -->
      <% else %>
        <li class="recipe-actions__list-item">
          <%= render partial: "meal_plans/hidden_form_add_recipe",
            locals: {
              meal_plan: @meal_plan,
              recipe: @recipe,
            }
          %>
        </li>
      <% end %>

      <!-- If the current user is the creator of this recipe,
           allow them to edit or destroy the recipe. -->
      <% if @recipe.user.present? and @recipe.user == current_user %>
        <li class="recipe-actions__list-item"><%= link_to "Make Some Changes", edit_recipe_path(@recipe) %></li>
        <li class="recipe-actions__list-item"><%= link_to "Erase From Database", @recipe, method: :delete %></li>

      <!-- Otherwise, allow the current user to save the recipe
           as a favorite of sorts. -->
      <% else %>
        <li class="recipe-actions__list-item"><%= link_to "Save This One", @recipe, data: { confirm: "Save this recipe even though you didn't write it yourself." } %></li>
      <% end %>
    </ul>
  </section>
<% end %>
